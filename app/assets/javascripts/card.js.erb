var Cards = (function () {
     var divs = [
    "<%= Card.new(1).make_div %>",
    "<%= Card.new(2).make_div %>",
    "<%= Card.new(3).make_div %>",
    "<%= Card.new(4).make_div %>",
    "<%= Card.new(5).make_div %>",
    "<%= Card.new(6).make_div %>",
    "<%= Card.new(7).make_div %>",
    "<%= Card.new(8).make_div %>",
    "<%= Card.new(9).make_div %>",
    "<%= Card.new(10).make_div %>",
    "<%= Card.new(11).make_div %>", 
    "<%= Card.new(12).make_div %>",
    "<%= Card.new(13).make_div %>",
    "<%= Card.new(14).make_div %>",
    "<%= Card.new(15).make_div %>",
    "<%= Card.new(16).make_div %>",
    "<%= Card.new(17).make_div %>",
    "<%= Card.new(18).make_div %>",
    "<%= Card.new(19).make_div %>",
    "<%= Card.new(20).make_div %>",
    "<%= Card.new(21).make_div %>",
    "<%= Card.new(22).make_div %>",
    "<%= Card.new(23).make_div %>",
    "<%= Card.new(24).make_div %>",
    "<%= Card.new(25).make_div %>",
    "<%= Card.new(26).make_div %>",
    "<%= Card.new(27).make_div %>",
    "<%= Card.new(28).make_div %>",
    "<%= Card.new(29).make_div %>",
    "<%= Card.new(30).make_div %>",
    "<%= Card.new(31).make_div %>",
    "<%= Card.new(32).make_div %>",
    "<%= Card.new(33).make_div %>",
    "<%= Card.new(34).make_div %>",
    "<%= Card.new(35).make_div %>",
    "<%= Card.new(36).make_div %>",
    "<%= Card.new(37).make_div %>",
    "<%= Card.new(38).make_div %>",
    "<%= Card.new(39).make_div %>",
    "<%= Card.new(40).make_div %>",
    "<%= Card.new(41).make_div %>",
    "<%= Card.new(42).make_div %>",
    "<%= Card.new(43).make_div %>",
    "<%= Card.new(44).make_div %>",
    "<%= Card.new(45).make_div %>",
    "<%= Card.new(46).make_div %>",
    "<%= Card.new(47).make_div %>",
    "<%= Card.new(48).make_div %>",
    "<%= Card.new(49).make_div %>",
    "<%= Card.new(50).make_div %>",
    "<%= Card.new(51).make_div %>",
    "<%= Card.new(52).make_div %>",
    "<%= Card.make_back %>"	 
     ];
    var how_many = 0;
    return {
         create_card: function(card_id){
	     how_many++;
	     var card = {
	         card_id: card_id,
		 x: 0,
		 y: 0,
		 z: 0,
		 element_id: "card" + how_many ,
		 selected: false,
		 stack_id: null,
             to_s: function() {
		 return "id:" + this.card_id;
	     },
             jump_to: function(px,py,pz){
		 this.set_position(px,py,pz);
	     },
	     make_div: function() {
		 if (this.card_id != 53 ) {
		     return "<div class='card' id='" + this.element_id + "'>" + divs[card_id-1] +  "</div>";
		 } else {
		     return "<div class='card' id='" + this.element_id + "'>" + divs[52] +  "</div>";
		 };
	     },         
	     get_div: function() {
		 return $('#' + this.element_id);
		 },
	     on_click: function(ele){
		 if (card.selected === false ) {
		     card.select();
		 } else {
		     card.deselect();
		 };
		 
	     },
             set_position: function(px,py,pz){
		 this.x = px;
		 this.y = py;
		 this.z = pz;
	     },
	     deselect: function(){
		 this.selected = false;
		 this.get_div().removeClass("selected");
	     },
	     select: function() {
		 this.selected = true;
		 this.get_div().addClass("selected");
		 },	 
	     show: function(parent){
		 this.get_div().remove();
		 parent.prepend(this.make_div());
		 this.get_div().css({position: "absolute"}).css({left:this.x + "px",top:this.y+"px", zIndex:this.z });
		 this.get_div().click(this.on_click);
		
	     },
             move_to: function(px,py,pz) {
		 this.get_div().snabbt({ position:[px-this.x, py-this.y ,this.z],
					 duration: 500,
					 delay: 10,
					 easing: 'spring'
				         });
		 this.get_div().css({position: "absolute"}).css({left:this.x + "px",top:this.y+"px",zIndex: pz  })
	         this.x = px;
		 this.y = py;
		 this.z = pz;
	        }
		
	     };
	     return card;
	 }
    };
})();
